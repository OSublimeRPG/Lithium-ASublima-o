<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sublima칞칚o</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Marcellus+SC:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,600&family=Libre+Baskerville&display=swap');

  body {
    background-color: #2b1f1a;
    background-image: url("https://www.transparenttextures.com/patterns/45-degree-fabric-dark.png");
    color: #f0e9df;
    font-family: 'Marcellus SC', serif;
    margin: 0;
    padding: 0;
    transform: translateY(-11px);
  }

  .container {
    background-color: rgba(47, 29, 28, 0.7);
    transform: translateY(-64px);
    width: 700px;
    max-width: 90%;
    margin: 60px auto 40px auto;
    padding: 40px 20px;
    box-shadow: 0 0 10px #00000055;
    border: none;
  }

  h1 {
    font-family: 'Marcellus SC', serif;
    color: #ab8c6d;
    text-align: center;
    border-bottom: 2px solid #a67c52;
    padding-bottom: 10px;
    margin-bottom: 30px;
    line-height: 37.9px;
    letter-spacing: 3.5px;
    word-spacing: -5px;
    text-transform: capitalize;
  }

  label {
    display: block;
    margin-top: 20px;
    font-size: 20px;
  }

  input, textarea, select {
    width: 100%;
    padding: 6px;
    font-size: 18px;
    background: #3e2e28;
    border: 1px solid #a67c52;
    border-radius: 3px;
    color: #f0e9df;
  }

  button {
    margin-top: 20px;
    padding: 12px 20px;
    font-size: 20px;
    background-color: #a67c52;
    color: #fff;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }

  .personagens-salvos {
    margin-top: 80px;
    padding: 20px;
    background: #3e2e28;
    border: 1px solid #a67c52;
    border-radius: 3px;
    transform: translateY(-64px);
  }

  .personagem {
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px dashed #a67c52;
  }

  .vida-controls {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  p {
    color: #f0e9df;
  }

  #botaoCarregarLink {
    transform: translateY(-11px);
  }

  @media (max-width: 600px) {
    .container {
      padding: 20px 10px;
    }

    h1 {
      font-size: 28px;
    }

    label {
      font-size: 18px;
    }

    input, textarea, select {
      font-size: 16px;
      padding: 5px;
    }

    button {
      font-size: 18px;
      padding: 10px 16px;
    }

    .vida-controls {
      flex-direction: column;
      align-items: flex-start;
      gap: 5px;
    }

    .vida-controls input {
      width: 100%;
    }
  }
  </style>
</head>
<body>
  <div class="container">
    <h1>Criador de Personagem</h1>
    <form id="formPersonagem">
      <label for="nome">Nome</label>
      <input type="text" id="nome" required>

      <label for="conceito">Conceito</label>
      <input type="text" id="conceito" required>

      <label for="classe">Classe</label>
      <select id="classe" required>
        <option value="desacreditado">Desacreditado</option>
        <option value="acreditado">Acreditado</option>
      </select>

      <label for="historia">Hist칩ria</label>
      <textarea id="historia" rows="4" required></textarea>

      <label for="itens">3 Itens (separados por v칤rgula)</label>
      <input type="text" id="itens" required>

      <button type="submit">Salvar Personagem</button>
    </form>

    <div class="personagens-salvos" id="personagensSalvos">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0;">Personagens Salvos</h2>
        <div style="display: flex; align-items: center; gap: 5px;">
          <input type="text" id="inputLinkPersonagem" placeholder="Cole o link aqui" style="padding: 5px; font-size: 14px; width: 200px;">
          <button id="botaoCarregarLink" style="padding: 5px; cursor: pointer;">游댌</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const form = document.getElementById('formPersonagem');
  const lista = document.getElementById('personagensSalvos');

  function estadoDeSaude(dano, vidaMax) {
    const restante = vidaMax - dano;
    const porcentagem = (restante / vidaMax) * 100;

    if (porcentagem === 100) return 'Saud치vel';
    if (porcentagem >= 60) return 'Cansado';
    if (porcentagem >= 20) return 'Ferido';
    if (porcentagem > 0) return ' beira do colapso';
    return 'Inconsciente';
  }

  function gerarFicha(personagem) {
    return `FICHA DE PERSONAGEM\nSistema 2d6 - Estilo P칩s-Apocal칤ptico\n\nNome do Personagem: ${personagem.nome}\nConceito: ${personagem.conceito}\n\nHist칩ria do Personagem:\n${personagem.historia}\n\nEstado de Infec칞칚o: ${personagem.infeccao || 'Est치gio 1'}\n\nItens:\n1. ${personagem.itens.split(',')[0] || ''}\n2. ${personagem.itens.split(',')[1] || ''}\n3. ${personagem.itens.split(',')[2] || ''}`;
  }

  function baixarFicha(personagem) {
    const ficha = gerarFicha(personagem);
    const blob = new Blob([ficha], { type: 'text/plain;charset=utf-8' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `ficha_${personagem.nome}.txt`;
    link.click();
  }

  function gerarLinkCompartilhamento(personagem) {
    const json = JSON.stringify(personagem);
    const encoded = encodeURIComponent(btoa(json));
    const url = `${location.origin}${location.pathname}?data=${encoded}`;
    navigator.clipboard.writeText(url)
      .then(() => alert("Link copiado para a 치rea de transfer칡ncia!"))
      .catch(() => alert("N칚o foi poss칤vel copiar o link."));
  }

  function carregarPersonagemPorLink() {
    const input = document.getElementById('inputLinkPersonagem');
    const link = input.value.trim();
    
    if (!link) {
      alert("Por favor, cole um link v치lido.");
      return;
    }

    try {
      const urlParams = new URL(link).searchParams;
      const data = urlParams.get('data');
      if (data) {
        const personagem = JSON.parse(atob(decodeURIComponent(data)));
        const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
        personagens.push(personagem);
        localStorage.setItem('personagens', JSON.stringify(personagens));
        alert("Personagem carregado com sucesso!");
        renderizarPersonagens();
      } else {
        alert("O link fornecido n칚o cont칠m dados de personagem.");
      }
    } catch (e) {
      alert("Erro ao processar o link. Certifique-se de que 칠 um link v치lido.");
    }
  }

  function removerPersonagem(index) {
    const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
    personagens.splice(index, 1);
    localStorage.setItem('personagens', JSON.stringify(personagens));
    renderizarPersonagens();
  }

  function atualizarVida(index, novaVida) {
    const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
    personagens[index].vida = parseInt(novaVida);
    localStorage.setItem('personagens', JSON.stringify(personagens));
    renderizarPersonagens();
  }

  function atualizarInfeccao(index, novoEstagio) {
    const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
    personagens[index].infeccao = novoEstagio;
    localStorage.setItem('personagens', JSON.stringify(personagens));
  }

  function renderizarPersonagens() {
    const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
    lista.innerHTML = ` 
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0;">Personagens Salvos</h2>
        <div style="display: flex; align-items: center; gap: 5px;">
          <input type="text" id="inputLinkPersonagem" placeholder="Cole o link aqui" style="padding: 5px; font-size: 14px; width: 200px;">
          <button id="botaoCarregarLink" style="padding: 5px; cursor: pointer;">游댌</button>
        </div>
      </div>
    `;

    personagens.forEach((p, i) => {
      if (!p.vida) p.vida = 0;
      if (!p.infeccao) p.infeccao = 'Est치gio 1';
      const vidaMax = p.classe === 'desacreditado' ? 20 : 10;
      const div = document.createElement('div');
      div.classList.add('personagem');
      div.innerHTML = `
        <strong>${p.nome}</strong> - <em>${p.conceito}</em>
        <br>
        <p><strong>Hist칩ria:</strong> ${p.historia}</p>
        <p><strong>Itens:</strong> ${p.itens}</p>
        <p><strong>Classe:</strong> ${p.classe === 'desacreditado' ? 'Desacreditado' : 'Acreditado'}</p>
        <p><strong>Vida:</strong> ${vidaMax - p.vida} / ${vidaMax} (${estadoDeSaude(p.vida, vidaMax)})</p>
        <div class="vida-controls">
          <p>Pontos de Dano:</p>
          <input type="number" min="0" max="${vidaMax}" value="${p.vida}" onchange="atualizarVida(${i}, this.value)">
        </div>
        <label>Infec칞칚o:</label>
        <select onchange="atualizarInfeccao(${i}, this.value)">
          <option ${p.infeccao === 'Est치gio 1' ? 'selected' : ''}>Est치gio 1</option>
          <option ${p.infeccao === 'Est치gio 2' ? 'selected' : ''}>Est치gio 2</option>
          <option ${p.infeccao === 'Est치gio 3' ? 'selected' : ''}>Est치gio 3</option>
          <option ${p.infeccao === 'Est치gio 4' ? 'selected' : ''}>Est치gio 4</option>
        </select>
        <br><br>
        <button onclick="removerPersonagem(${i})">Remover Personagem</button>
      `;

      const linkButton = document.createElement('button');
      linkButton.innerText = 'Compartilhar com Link';
      linkButton.onclick = () => gerarLinkCompartilhamento(p);
      div.appendChild(linkButton);

      lista.appendChild(div);
    });

    // Reatribuir evento ao bot칚o ap칩s re-renderiza칞칚o
    document.getElementById('botaoCarregarLink').addEventListener('click', carregarPersonagemPorLink);
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const classe = document.getElementById('classe').value;
    const vidaMax = classe === 'desacreditado' ? 20 : 10;

    const personagem = {
      nome: document.getElementById('nome').value,
      conceito: document.getElementById('conceito').value,
      classe: classe,
      historia: document.getElementById('historia').value,
      itens: document.getElementById('itens').value,
      vida: 0, // dano
      infeccao: 'Est치gio 1'
    };
    const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
    personagens.push(personagem);
    localStorage.setItem('personagens', JSON.stringify(personagens));
    form.reset();
    renderizarPersonagens();
  });

  function importarViaURL() {
    const params = new URLSearchParams(window.location.search);
    const data = params.get('data');
    if (data) {
      try {
        const json = atob(decodeURIComponent(data));
        const personagem = JSON.parse(json);
        const personagens = JSON.parse(localStorage.getItem('personagens')) || [];
        personagens.push(personagem);
        localStorage.setItem('personagens', JSON.stringify(personagens));
      } catch (e) {
        alert("Erro ao importar personagem via link.");
      }
    }
  }

  document.getElementById('botaoCarregarLink').addEventListener('click', carregarPersonagemPorLink);
  importarViaURL();
  renderizarPersonagens();
</script>
</body>
</html>
